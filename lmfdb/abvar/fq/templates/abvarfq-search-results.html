{% extends 'homepage.html' %}

{% block content %}

{% if info.stats %}
<p>
{{info.stats|safe}}
</p>
{% endif %}

<h2> Refine search </h2>

<form id='re-search'>
<input type="hidden" name="start" value="{{info.start}}"/>
<input type="hidden" name="count" value="{{info.count}}"/>

<table border="0">

<tr>
<td align=left>{{ KNOWL('ag.field_of_definition',title = "cardinality of the base field") }}</td>
<td align=left>{{ KNOWL('ag.dimension',title = "dimension") }}</td>
<td align=left>{{ KNOWL('abvar.simple',title="simple only") }}</td>
<td align=left>{{ KNOWL('ag.primitive',title="primitive only") }}</td>
<td align=left>{{ KNOWL('abvar.p_rank',title="p-rank") }}</td>
<td align=left>{{ KNOWL('lf.newton_polygon',title="Newton polygon") }}</td>
</tr>

<tr>
<td><input type='text' name='q' size=10 value="{{info.q}}" /></td>
<td><input type='text' name='g' size=10 value="{{info.g}}" /></td>
<td><select name='simple_only'>
    {% if info.simple_only == "yes" %}
    <option value ="no">no</option>
    <option value ="yes" selected = "yes">yes</option>
    {% else %}
    <option value ="no" selected = "no">no</option>
    <option value ="yes">yes</option>
    {% endif %}
    </select></td>
<td><select name='primitive_only'>
    {% if info.primitive_only == "yes" %}
    <option value ="no">no</option>
    <option value ="yes" selected = "yes">yes</option>
    {% else %}
    <option value ="no" selected = "no">no</option>
    <option value ="yes">yes</option>
    {% endif %}
    </select></td>
<td><input type='text' name='p_rank' size=10 value="{{info.p_rank}}" /></td>
<td><input type='text' name='newton_polygon' size=10 value="{{info.newton_polygon}}" /></td>
</tr>

<tr>
<td align=left>initial coefficients</td>
<td align=left>{{ KNOWL('ag.point_count',title="point count of the abelian variety") }}</td>
<td align=left>{{ KNOWL('abvar.curve_point_count',title="point count of the curve") }}</td>
<td align=left>{{ KNOWL('abvar.decomposition',title="isogeny factors decomposition") }}</td>
</tr>

<tr>
<td><input type='text' name='initial_coefficients' size=10 value="{{info.initial_coefficients}}" /></td>
<td><input type='text' name='abvar_point_count' size=10 value="{{info.abvar_point_count}}" /></td>
<td><input type='text' name='curve_point_count' size=10 value="{{info.curve_point_count}}"/></td>
<td><input type='text' name='decomposition' size=10 value="{{decomposition}}"/></td>
</tr>

<tr>
<td>
<button type='submit' value='refine'>Search again</button>
</td> </tr>
</table>

</form>

{% if info.err is defined %}

<h2>Error</h2>
<div>
  {{ info.err|safe }}
  <p>
  Either modify your search above or go <input type=button value="Back" onClick="history.go(-1)">
</div>

{% else %}

<style type="text/css">
table td.center {
  text-align: center;
  padding : 4px;
}
table td.params {
  text-align: left;
  font-family: monospace;
}
</style>


<h2> Results ({{info.report}})
{% if info.start > 0 %}
<a href="#" class="navlink"
   onclick="decrease_start_by_count_and_submit_form('re-search');return
            false">Previous</A>
{% endif %}
{% if info.more > 0 %}
<a href="#" class="navlink" onclick="increase_start_by_count_and_submit_form('re-search');return false">Next</A>
{% endif %}

</h2>
<table>
<tr>
  <th class="center">{{ KNOWL('abvar.fq.lmfdb_label',title="LMFDB label") }}</th>
  <th class="center">{{ KNOWL('ag.dimension',title = "dimension") }}</th>
  <th class="center">{{ KNOWL('ag.field_of_definition',title = "base field") }}</th>
  <th class="center">{{ KNOWL('abvar.fq.weil_polynomial',title="Weil polynomial") }}</th>
  <th class="center">{{ KNOWL('abvar.p_rank',title="p-rank") }}</th>
  <th align="left">{{ KNOWL('abvar.decomposition',title="decomposition type") }}</th>
</tr>
{% for abvar in info.abvars: %}
<tr>
<td class="center"><a href="{{ url_for('abvarfq.by_label',label=abvar.label) }} ">{{abvar.label}}</a></td>
<td class="center">
 {{abvar.g}}
</td>
<td class="center">{{abvar.base_field}}</td>
<td class="center">{{abvar.polynomial}}</td>
<td class="center">{{abvar.p_rank}}</td>
<td class="left">{{abvar.decomposition}}</td>
</tr>
{% endfor %}
</table>

<hr>
{% if info.start > 0 %}
<a href="#" class="navlink"
   onclick="decrease_start_by_count_and_submit_form('re-search');return
            false">Previous</A>
{% endif %}
{% if info.more > 0 %}
<a href="#" class="navlink" onclick="increase_start_by_count_and_submit_form('re-search');return false">Next</A>
{% endif %}

{% endif %}

<!-- Download Data!! Whoohooo!! -->
<form>
Download all search results for
<input type="submit" name="Submit" value="gp">
<input type="submit" name="Submit" value="sage">
<input type="submit" name="Submit" value="magma">
<input type="hidden" name="download" value="1"/>
<input type="hidden" name="query" value="{{info.query}}"/>
</form>



<!-- Debugging! -->
{% if DEBUG %}
<hr>
<div>
Query was: {{info.query}}
</div>
Start = {{info.start}}, Count = {{info.count}}
{% endif %}



{% endblock %}
