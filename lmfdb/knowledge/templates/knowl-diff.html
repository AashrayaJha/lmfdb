{% extends "homepage.html" %}


{#  {% include "mergely.html" %} #}
{% block content %}

  <script type="text/javascript" src="/static/diff_match_patch.js"></script>
  <script type="text/javascript">
  $(document).ready(function () {
    var comp = $('#compare');
    comp.mergely({
      license: 'gpl-separate-notice',
      cmsettings: {
        readOnly: false,
        linewrap: true,
        viewportMargin: 500,
      },
      lineNumbers: true,
      wrap_lines: true,
      width: 'auto',
      height: 'calc(100% - 40px)',
      ignorews: true,
    });

    var lhs = null;
    $.ajax({
      type: 'GET', async: true, dataType: 'text',
      url: '/knowledge/content/cmf/1545201145469776',
      success: function (response) {
        lhs = response;
        comp.mergely('lhs', response);
      }
    });

    var rhs = null;
    $.ajax({
      type: 'GET', async: true, dataType: 'text',
      url: '/knowledge/content/cmf',
      success: function (response) {
        rhs = response;
        comp.mergely('rhs', response);
      }
    });


    function diff(text1, text2) {
      var dmp = new diff_match_patch();
      dmp.Diff_Timeout = 2;//parseFloat(document.getElementById('timeout').value);
      dmp.Diff_EditCost = 5;
      var diffs = dmp.diff_main(text1, text2);
      //dmp.diff_cleanupSemantic(d);
      dmp.diff_cleanupEfficiency(diffs);
      var ds = dmp.diff_prettyHtml(diffs).replace(/&para;<br>/g,'');
      return ds;
    };
    var inline = $('#compareinline');

    function wait_for_text(){
      if(lhs != null && rhs != null){
        inline.html( '<pre>' + diff(lhs, rhs) + '</pre>');
      }
      else{
        setTimeout(wait_for_text, 250);
      }
    }
        setTimeout(wait_for_text, 250);

  //try
  //{
  //renderMathInElement(inline.get(0), katexOpts);
  //}
  //catch(err) {
  //log("err:" + err)
  //}

  //jQuery.extend
  //(
  //    {
  //        getValues: function(url, type) 
  //        {
  //            var result = null;
  //            $.ajax(
  //                {
  //                    url: url,
  //                    type: 'get',
  //                    dataType: 'html',
  //                    async: false,
  //                    cache: false,
  //                    success: function(data) 
  //                    {
  //                        result = data;
  //                    }
  //                }
  //            );
  //           return result;
  //        }
  //    }
  //);

  });
</script>
<style>
/* Initial height */
.diff {
  overflow: auto;
  resize: vertical;
  padding: 20px;
}
 /* Auto-height fix */
 .mergely-column .CodeMirror {
   height: auto;
 }

 .inline{
   font-family: monospace;
 }
 pre {
   white-space: pre-wrap;       /* Since CSS 2.1 */
   white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
   white-space: -pre-wrap;      /* Opera 4-6 */
   white-space: -o-pre-wrap;    /* Opera 7 */
   word-wrap: break-word;       /* Internet Explorer 5.5+ */
 }
 del {
   background: #FFE6E6;
 }
 ins {
   background: #E6FFE6;
 }
</style>

<h3> Mergely </h3>
<div class="diff">
  <div id="compare"></div>
</div>
<h3> google diff js </h3>
<div class="inline">
  <div id="compareinline"></div>
</div>

{% endblock %}


